<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<script type="text/javascript">

/* Reset all the variables */
var lat = 0;
var lng = 0;
var cityName = "New City";

var population = 10000;
	var availablePop = 10000;
	var armySize = 50;
		var militia = 50;
		var infantry = 0;
		var marines = 0;
		var tanks = 0;
		var APCs = 0;
		var IFVs = 0;
		var fieldGuns = 0;
		var artillery = 0;
		var fixedGuns = 0;
		var fanatics = 1;
	var resourcePop = 0;
		var foodPop = 250;
		var fuelPop = 250;
		var metalPop = 250;
	var productionPop = 0;
	var popModifier = 1;
	
var food = 20000;
var fuel = 10000;
var metal = 10000;

var production = availablePop*50;
	var productionModifier = 50;
	var warehouseLevel = 4;
		var capacity;
	var barracksLevel = 1;
	var fortLevel = 1;
	var roadLevel = 0;
	var workshopLevel = 0;
	var schoolLevel = 1;
	var hospitalLevel = 0;
	var factoryLevel = 0;
	var airportLevel = 0
	var shipyardLevel = 0;
	var laboratoryLevel = 0;
		var supercomputerLevel;
		var ethanolLevel;
		var hydroponicsLevel;
		var recyclingLevel;
		var nuclearLevel;
		var launchpadLevel;

var loyalty = 100;
	var politics;
		var politicstypes = ["Democracy", "Republic", "Autocracy"];
		var politicssymbols = ["‚òë", "‚úç", "‚ôî"];
		var politicschoice = 1;
	var society;
		var societytypes = ["Libertarian", "Tolerant", "Conservative"];
		var societysymbols = ["üóΩ", "‚òÆ", "üî®"];
		var societychoice = 1;
	var capital;
		var capitaltypes = ["Syndicalist", "Decentralized", "Capitalist"];
		var capitalsymbols = ["‚í∂", "‚òç", "$"];
		var capitalchoice = 1;
	var economy
		var economytypes = ["Free Market", "Mixed", "Planned"];
		var economysymbols = ["‚öñ", "‚òä", "‚ò≠"];
		var economychoice = 1;
	var religionsystems;
		var religionsystemstypes = ["Free Religion", "State Atheism", "Theocracy"];
		var religionsystemssymbols = ["‚ò™‚ò∏xis‚ò©", "‚öõ", "‚ôó"];
		var religionsystemschoice = 0;
		var orthodox = 10;
		var catholic = 10;
		var protestant = 10;
		var sunni = 10;
		var shia = 10;
		var buddhist = 10;
		var sikh = 10;
		var pagan = 15;
		var atheist = 15;
		var majorReligions = ["Orthodox", "Catholic", "Protestant", "Sunni", "Shia", "Buddhist", "Sikh", "Pagan", "Irreligious"];
			var religionsymbols = ["‚ò¶","‚úù","‚úû","‚ò™","‚ò´","‚ò∏","‚ò¨","‚õ§","Œ±Œ∏ŒµŒøŒπ"];
			var religionquotes = ["I believe in one God, Father Almighty, Creator of heaven and earth, and of all things visible and invisible. And in one Lord Jesus Christ, the only-begotten Son of God, begotten of the Father before all ages.", "Now the Catholic Faith is this: We worship One God in Trinity and Trinity in Unity, neither confounding the Persons nor dividing the substance.",  "I believe in the Holy Ghost, the Holy Christian Church, the Communion of Saints, the Forgiveness of sins, the Resurrection of the Body, and the Life everlasting.  Amen.",  "There is no god but God, and Muhammad is the messenger of God.", "There is no god but God, and Muhammad is the messenger of God, and Ali is the viceregent of God.", "Suffering exists. There is a cause for suffering. There is an end to suffering. In order to end suffering, you must follow the Eightfold Path.",  "There exists but one God, who is called The True, The Creator, Free from fear and hate, Immortal, Not begotten, Self-Existent, Great and Compassionate." ]
			var religionUnits = ["Varagnian", "Crusader", "Puritan", "Mujahadin", "Assassin", "Shaolin Monk", "Punjabi"];
			var stateReligion = 0;
				stateReligion.programs = ["Charity", "Asceticism", "Missionaries", "Pilgrimage", "Holy War"];
				stateReligion.program = 0;
				stateReligion.buildings = ["hospitalLevel", "warehouseLevel", "schoolLevel", "roadLevel", "fortLevel"];
			var fanaticCity = cityName;
		var paganism 
			paganism.types = ["Cult of Personality", "Hindu", "Chinese", "Shinto", "Norse", "Egyptian", "Greek", "Animist"];
			paganism.choice = 1;
			paganism.programs = ["Creator God", "War God", "Harvest God", "Sea God", "Underworld God"];
			paganism.results = ["productionModifier += .1", "loyalty+=10", "food *= 1.1; metal *= 1.1; fuel *= 1.1", "fortLevel += Math.round(pagan/5)"];
			paganism.lastFestival = new Date();

function getReligion(latitude, longitude){
/*DUMMY FUNCTION

Determines pagan and atheist population, then fills in the rest.

If in Eurasia, based on proximity to holy cities.
If in Africa, based on latitude.
If in Americans, based on proximity to equator.*/
}

getReligion(lat,lng);
/* If the city is new, put this time as the last update. */

var lastUpdate = new Date();

/* Then we replace the default variables with whatever we pull from the database (will write AJAX functions later)*/

function getStats(lat, lng){
/* DUMMY FUNCTION

Will call the database, pull the statistics from it based on x and y coordinates, and replace the variables. */	
}

function uploadStats(){
/*DUMMY FUNCTION

Will call the database and update all the entries for this city, based on current variables.*/	
}

function loadQueue(){
/*DUMMY FUNCTION

Will load the queue from a database.
*/
}

//getStats(x, y);

/* Function to write out the stats on the page */

function writeStats(){
	document.getElementById("pop").innerHTML=Math.round(population);
		document.getElementById("available").innerHTML=Math.round(availablePop);
		document.getElementById("farmers").innerHTML=Math.round(foodPop);
		document.getElementById("oil workers").innerHTML=Math.round(fuelPop);
		document.getElementById("miners").innerHTML=Math.round(metalPop);
	document.getElementById("food").innerHTML=Math.round(food);
	document.getElementById("fuel").innerHTML=Math.round(fuel);
	document.getElementById("metal").innerHTML=Math.round(metal);
	document.getElementById("loyalty").innerHTML=Math.round(loyalty);
	//army numbers
	document.getElementById("militianum").innerHTML=militia;
	document.getElementById("infantrynum").innerHTML=infantry;
	document.getElementById("marinenum").innerHTML=marines;
	document.getElementById("tanknum").innerHTML=tanks;
	document.getElementById("ifvnum").innerHTML=IFVs;
	document.getElementById("apcnum").innerHTML=APCs;
	document.getElementById("fieldgunnum").innerHTML=fieldGuns;
	document.getElementById("artillerynum").innerHTML=artillery;
	document.getElementById("fixedgunnum").innerHTML=fixedGuns;
	//building levels
	document.getElementById("warehousespan").innerHTML=warehouseLevel;
	//politics and religion
	document.getElementById("political").innerHTML=politicstypes[politicschoice];
	document.getElementById("social").innerHTML=societytypes[societychoice];
	document.getElementById("capital").innerHTML=capitaltypes[capitalchoice];
	document.getElementById("economic").innerHTML=economytypes[economychoice];
	document.getElementById("religious").innerHTML=religionsystemstypes[religionsystemschoice];
}

/* Function to mathematically update the stats*/

function update(){
	writeStats();
	
	//Figure out the time elapsed
	
	var now = new Date();
	var quarterdaysElapsed = (now.getTime() - lastUpdate.getTime())/21600000;
	
	//Fix some stats
	
	resourcePop = foodPop + fuelPop + metalPop;
	armySize = militia + infantry + marines + tanks*4 + APCs*6 + IFVs*5 + fieldGuns*5 + artillery*8 + fixedGuns*10;
	availablePop = population - (armySize + resourcePop + productionPop);
	
	//Fix the politics & religion stuff
	if (fanaticCity == cityName)
		fanatics = 1;
	else
		fanatics = 0;
	var religious = (orthodox+catholic+protestant+sunni+shia+buddhist+sikh+pagan)
	if (religious < 100)
		atheist = 100-religious;
	
	// Now actually run the resource formula
	
	population += ((Math.log((food+1)/population)*population)*popModifier)*quarterdaysElapsed;
	production = availablePop*productionModifier;
	food += 40*(foodPop * quarterdaysElapsed);
	fuel += 40*(fuelPop * quarterdaysElapsed);
	metal += 40*(metalPop * quarterdaysElapsed);
	//capacity limit
	capacity = warehouseLevel*1300 + 10000;
	if (food > capacity)
		food = capacity;
	if (fuel > capacity)
		fuel = capacity;
	if (metal > capacity)
		metal = capacity;
		
	//check the queue
	if (!doingQueue && queue.length > 0)
		doQueue();
	
	//now record it for posterity
	writeStats();
	uploadStats();
	lastUpdate = new Date();
}

//queue item object

var queue = new Array();
var doingQueue = false;
var intervalid = 0;
var queuetimes = new Array();
loadQueue();
var queueHTML;

function queueItem(itemdescription,foodCost,fuelCost,metalCost,productionCost,endResult){
	this.description = itemdescription;
	this.food = foodCost;
	this.fuel = fuelCost;
	this.metal = metalCost;
	this.duration = (productionCost/production);
		this.duration *= 600000;
		this.completionDate = new Date();
		this.completionDate.setDate(this.completionDate.getDate()+this.duration);
	//should be the code IN TEXT QUOTES; unless someone else has a better way
	this.result = endResult;
	this.itemText = document.createElement("div");
	this.itemText.setAttribute("style", "border:black;");
	this.itemText.innerHTML = "<b>" + this.description + "</b> Completion time: ";
	queueHTML.appendChild(this.itemText);
	this.durationText = document.createElement("span");
	this.durationText.setAttribute("name", this.description);
	queueHTML.appendChild(this.durationText);
    this.durationText.innerHTML = (this.duration/1000) + " seconds";
    if (queuetimes.length > 0)
	queuetimes.push(this.duration/1000 - queuetimes[0]);
    else
	queuetimes.push(this.duration/1000);
}

//goes through the queue

function doQueue () {
    var current = queue[0];
    eval(current.result);
    food -= current.food;
    fuel -= current.fuel;
    metal -= current.metal;
    queue.shift();
    for (var c=0;c<2;c++)
	queueHTML.removeChild(queueHTML.childNodes[1]);
    update();
    if (queue.length > 0) {
	doingQueue = true;
	clearInterval(intervalid);
	intervalid = setInterval("queue[0].durationText.innerHTML = queuetimes[0] + \" seconds\";queuetimes[0]--;", 1000);
	setTimeout("queuetimes.shift();clearInterval(intervalid);doQueue()", queue[0].duration);
	setTimeout(doQueue(), queue[0].duration);
    } else {
	doingQueue = false;
    }
}


//queues units; DUH!

function buildUnits(unitSource){
	if (unitSource = "barracks") {
		var dropDown = document.getElementById("barrackstype");
		var unitType = dropDown.selectedIndex;
		var unitNumber = document.getElementById("barracksnumber").value;
		//make sure it isn't taken as text
		unitNumber = parseInt(unitNumber);
		switch(unitType){
			case 0:
				if (food > unitNumber*50 && fuel > unitNumber*10 && metal > unitNumber*30 && availablePop > unitNumber) {
					queue.push(new queueItem(unitNumber +  " Militia", unitNumber*50, unitNumber*10, unitNumber*30, unitNumber*60, "militia += " + unitNumber));
			    return true;
				} else
				alert("Insufficient funds.");
			break;
			case 1:
			if (food > unitNumber*30 && fuel > unitNumber*70 && metal > unitNumber*30 && availablePop > unitNumber) {
					queue.push(new queueItem(unitNumber + " Infantry", unitNumber*30, unitNumber*70, unitNumber*30, unitNumber*65, "infantry += " + unitNumber));
			    return true;
				} else
				alert("Insufficient funds.");
			break;
			case 2:
			if (food > unitNumber*60 && fuel > unitNumber*40 && metal > unitNumber*30 && availablePop > unitNumber) {
					queue.push(new queueItem(unitNumer + " Marines", unitNumber*60, unitNumber*40, unitNumber*30, unitNumber*65, "marines += " + unitNumber));
			    return true;
				} else
				alert("Insufficient funds.");
			break;
		}
	    return false;
	}
}


//queues buildings
function upgradeBuilding(buildingChoice){
    switch(buildingChoice) {
		case "warehouse":
			if (food > 8712 && fuel > 8015)
				queue.push(new queueItem("Warehouse Level " + parseInt(warehouseLevel+1), 1000+Math.pow(warehouseLevel, 2), 1500+Math.pow(warehouseLevel, 2), 2000+Math.pow(warehouseLevel, 2), 10*Math.pow(warehouseLevel, 3), "warehouseLevel+=1"));
		break;
	}
}

//viva la revoluci√≥n!
function revolution() {
var targetPolitics =  document.getElementById("revpolitics").selectedIndex;	
var targetSociety =  document.getElementById("revsociety").selectedIndex;
var targetCapital =  document.getElementById("revcapital").selectedIndex;
var targetEconomy =  document.getElementById("reveconomy").selectedIndex;
var targetReligionSystem =  document.getElementById("revreligion").selectedIndex;

queue.push(new queueItem("REVOLUTION!", 0, 0, 0, population, "politicschoice=" + targetPolitics + ";societyChoice=" + targetSociety + ";capitalchoice=" + targetCapital + ";economychoice=" + targetEconomy + "religionsystemschoice=" + targetReligionSystem + ";"));
}

</script>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>My City</title>
</head>

<body>

<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr>
    <td width="25%">
    	<h1><script type="text/javascript">document.write(cityName);</script></h1>
        <button onclick="update();">Update</button> <br />
    </td>
    <td width="75%">
    	<img src="http://forums.civfanatics.com/images/smilies/civ4/food.gif" alt="Food" />
        <span id="food"></span>
    	<img src="http://forums.civfanatics.com/images/smilies/civ4/science.gif" alt="Fuel" />
   	    <span id="fuel"></span>
    	<img src="http://forums.civfanatics.com/images/smilies/civ4/hammer.gif" alt="Metal" />
  		<span id="metal"></span>
        <br /> Population <span id="pop"></span> (<span id="available"></span> available)
        </td>
  </tr>
  <tr>
    <td>
	  <p><a href="#military">Military</a><br />
	    <a href="#government">Government</a><br />
	    <a>Religion</a><br />
      <a>World Map</a><br />
    </p></td>
    <td>
<div>
  <div align="right"><strong>Loyalty: <img src="http://forums.civfanatics.com/images/smilies/smile.gif" /><span id="loyalty"></span>%</strong></div>
</div>

<div id="queuediv" style="background:#666; color:#FFF;"><h3>Building Queue<h3></div>
<h2>Infrastructure </h2>

<p>Warehouse (Level <span id="warehousespan"></span>) <button onclick="update(); upgradeBuilding('warehouse');">Upgrade Warehouse</button>
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Farmers
<span id="farmers"></span>
	<button onclick="if(availablePop > 50) foodPop += 50; update();">+</button>
	<button onclick="if (foodPop > 50) foodPop -= 50; update();">-</button>
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Oil Workers 
<span id="oil workers"></span>
	<button onclick="if(availablePop > 50) fuelPop += 50; update();">+</button>
	<button onclick="if (fuelPop > 50) fuelPop -= 50; update();">-</button>
<br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Miners
<span id="miners"></span>
<button onclick="if(availablePop > 50) metalPop += 50; update();">+</button>
	<button onclick="if (metalPop > 50) metalPop -= 50; update();">-</button></p>
<p>Barracks <br />
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Recruit: 
<input name="barracksnumber" id="barracksnumber" type="text" value="100" />
<select id="barrackstype">
  <option>Militia</option>
  <option>Infantry</option>
  <option>Marines</option>
</select>
<button onclick='var buildunits = buildUnits("barracks"); if (buildunits && (!doingQueue)) {doingQueue = true;clearInterval(intervalid);intervalid = setInterval("queue[0].durationText.innerHTML = queuetimes[0] + \" seconds\";queuetimes[0]--;", 1000); setTimeout("clearInterval(intervalid);doQueue()", queue[0].duration);}'>Confirm</button>
</p>
<p>&nbsp;</p>
    </td>
  </tr>
</table>

<div id="militaryscreen" align="center"><h2><a name="military">Military</a></h2>
<table cellspacing="5">
<tr>
	<td>Infantry</td>
    <td>Armor</td>
    <td>Artillery</td>
</tr>
<tr>
	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/paratrooper.jpg" alt="Militia" width="20" height="20" /><span id="militianum"></span></td>
    <td><img src="http://www.civfanatics.com/images/civ4/info_center/units/modernarmor.jpg" alt="Tanks" width="20" height="20" /><span id="tanknum"></span></td>
    <td><img src="http://www.civfanatics.com/images/civ4/info_center/units/antitank.jpg" alt="Field Guns" width="20" height="20" /><span id="fieldgunnum"></span></td>
</tr>
<tr>
	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/infantry.jpg" alt="Infantry" width="20" height="20" /><span id="infantrynum"></span></td>
   	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/mechanizedinfantry.jpg" alt="Armored Personnel Carriers" width="20" height="20" /><span id="apcnum"></span></td>
   	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/mobileartillery.jpg" alt="Artillery" width="20" height="20" /><span id="artillerynum"></span></td>
</tr>
<tr>
	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/marine.jpg" alt="Marines" width="20" height="20" /><span id="marinenum"></span></td>
   	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/panzer.jpg" alt="Infantry Fighting Vehicles" width="20" height="20" /><span id="ifvnum"></span></td>
   	<td><img src="http://www.civfanatics.com/images/civ4/info_center/units/artillery.jpg" alt="Fixed Guns" width="20" height="20" /><span id="fixedgunnum"></span></td>
</tr>
</table>
</div>

<div id="govscreen" align="center"><h2><a name="government">Government</a></h2>

Political system: <b><span id="political"></span></b><br />
Social system: <b><span id="social"></span></b><br />
Capital system: <b><span id="capital"></span></b><br />
Economic systen: <b><span id="economic"></span></b><br />
Religious system: <b><span id="religious"></span></b>

<p><select id="revpolitics">
  <option>Launch Coup-d'etat!</option>
  <option>Rewrite Constitution!</option>
  <option>Hold Elections!</option>
</select>
&nbsp;For a&nbsp;
<select id="revsociety">
  <option>Libertarian</option>
  <option>Tolerant</option>
  <option>Conservative</option>
</select>
<select id="revreligion">
  <option>Secular</option>
  <option>State Atheist</option>
  <option>Theocratic</option>
</select>
<select id="revcapital">
  <option>Workers'</option>
  <option>Decentralized </option>
  <option>Capitalist</option>
</select>
<select id="reveconomy">
  <option>Free Market</option>
  <option>Mixed Economy</option>
  <option>Planned Economy</option>
</select>
<button onclick="revolution();">Revolution!</button>
</p>
</div>

<script type="text/javascript">update(); var queueHTML = document.getElementById("queuediv");</script>
</body>
</html>
